---
title: "Forest Vegetation Tree QC"
author: "John Paul Schmit"
date: "5/19/2020"
output: html_document
---


```{r tree_setup, include=F}
TotTrees<-nrow(QCTrees) #Total Number of tree records checked
TotStems<-nrow(QCStems) #Total number of stem records checked


Trees_Bad_Status<-QCTrees %>% filter(is.na(Status) | !Status %in% c(Live_Status, Dead_Status, Missing_Status, Other_Status) ) %>%
  select(Unit_Code, Plot_Name, Sample_Year, Tag, Latin_Name, Status)

Trees_No_Name<-QCTrees %>% filter(Latin_Name=="") %>%
  select(Unit_Code, Plot_Name, Sample_Year, Tag, Latin_Name)

Trees_Bad_Tag<-QCTrees %>% filter(is.na(Tag) | Tag < 1 | Tag>30000) %>%
  select(Unit_Code, Plot_Name, Sample_Year, Tag, Latin_Name)

Trees_Live_Bad_Crown<-QCTrees %>% filter(Status %in% Live_Status & (Crown_Description=="" | !Crown_Description %in% 
   c("Co-dominant", "Dominant", "Edge Tree", "Intermediate", "Light Gap Exploiter", "Open-grown", "Overtopped" ))) %>%
  select(Unit_Code, Plot_Name, Sample_Year, Tag, Latin_Name, Status, Crown_Description)

Trees_Unalive_Bad_Crown<-QCTrees %>% filter(!Status %in% Live_Status & Crown_Description!="") %>%
  select(Unit_Code, Plot_Name, Sample_Year, Tag, Latin_Name, Status, Crown_Description)

Trees_Bad_DBH_Check <-QCTrees %>% filter( (Sample_Year<2018 & DBH_Check) | 
      (Sample_Year>2017 & DBH_Check & 
          Status %in% c(Missing_Status, "Dead Fallen", "Dead Missing", "Dead - Too Small", Other_Status))) %>% 
    select(Unit_Code, Plot_Name, Sample_Year, Tag, Latin_Name, Status, DBH_Check)

Trees_Live_Bad_DBH<-QCTrees %>% filter(Status %in% Live_Status & (
   (is.na(Equiv_Live_DBH_cm) | Equiv_Live_DBH_cm < 10 | is.na(Equiv_Dead_DBH_cm) | ( Equiv_Dead_DBH_cm>0 & Equiv_Dead_DBH_cm < 10)) ))  %>% 
   select(Unit_Code, Plot_Name, Sample_Year, Tag, Latin_Name, Status, Equiv_Live_DBH_cm, Equiv_Dead_DBH_cm)

Trees_Dead_Bad_DBH<-QCTrees %>% filter(Status %in% c("Dead Leaning", "Dead Standing") & (
   (is.na(Equiv_Dead_DBH_cm) | Equiv_Dead_DBH_cm < 10 | is.na(Equiv_Live_DBH_cm) | Equiv_Live_DBH_cm>=10 |
      ( Equiv_Live_DBH_cm >0 & Equiv_Live_DBH_cm < 1)) ))  %>% 
   select(Unit_Code, Plot_Name, Sample_Year, Tag, Latin_Name, Status, Equiv_Live_DBH_cm, Equiv_Dead_DBH_cm)

Trees_Other_Bad_DBH<-QCTrees %>% filter(Status %in% c(Missing_Status, Other_Status, 
    "Dead", "Dead - Human Action", "Dead - Too Small", "Dead Fallen", "Dead Missing") & (
   (is.na(Equiv_Dead_DBH_cm) |is.na(Equiv_Live_DBH_cm) | Equiv_Live_DBH_cm!=0 |
       Equiv_Dead_DBH_cm !=0 )) )  %>% 
   select(Unit_Code, Plot_Name, Sample_Year, Tag, Latin_Name, Status, Equiv_Live_DBH_cm, Equiv_Dead_DBH_cm)

Stems_Live_Bad_DBH<-QCStems %>% filter(Live==T & Class=="Tree", (is.na(DBH) | DBH<1)) %>% 
  select(Unit_Code, Plot_Name, Sample_Year, Tag, Latin_Name, Status, DBH, Live )

Stems_Dead_Bad_DBH<-QCStems %>% filter(Live==F & Class=="Tree", (is.na(DBH) | DBH<10)) %>% 
  select(Unit_Code, Plot_Name, Sample_Year, Tag, Latin_Name, Status, DBH, Live )

Stems_Other_Bad_DBH<-QCStems %>% filter(Status %in% c(Missing_Status, Other_Status, 
    "Dead", "Dead - Human Action", "Dead - Too Small", "Dead Fallen", "Dead Missing")) %>% 
  select(Unit_Code, Plot_Name, Sample_Year, Tag, Latin_Name, Status, DBH, Live )

Trees_Live_Bad_Vigor<-QCTrees %>% filter(Status %in% Live_Status & 
      ( (Sample_Year<2017 & !is.na(TreeVigor)) | (Sample_Year >=2017 & (is.na(TreeVigor)  | !TreeVigor %in% 0:5)) )) %>% 
   select(Unit_Code, Plot_Name, Sample_Year, Tag, Latin_Name, Status, TreeVigor, VigorClass)

Trees_Unalive_Bad_Vigor<-QCTrees %>% filter(!Status %in% Live_Status & !is.na(TreeVigor)) %>% 
   select(Unit_Code, Plot_Name, Sample_Year, Tag, Latin_Name, Status, TreeVigor, VigorClass)

```

- should not start as missing, earlier ones should not start as dead, never start as dead fallen

- dead trees wth > 1cm live dbh should not exist in a microplot as it would be a sapling

- Add qc for stems

- Tree foliage condiditons only on living trees, percent between 1 and 100, condiition should be one of the choices in protocol
- tree conditions only on live trees, except for EAB on dead. never on missing. should be from list that was current.
- if condition is vines in crown, should have 1 or more vines on it. 
- should have a distance and azimuth <15m and between 0 and 360 (but not 0)
- How do we deal with removed from study? Need to check that everything that was suppsoed to be monitored was actualy monitored
- Tree disease on correct species



###  Tree Status
```{r Tree_Status, echo=FALSE, hold=FALSE, results="asis"}

if(nrow(Trees_Bad_Status)==0) cat(paste(TotTrees, " Tree records checked and all have a valid status.  \n")) else {
   cat("Tree records with an invalid status:  \n"); NiceTable(Trees_Bad_Status)}

```

---

### Species ID

```{r Tree_Species, echo=FALSE, hold=FALSE, results="asis"}
 
 if(nrow(Trees_No_Name)==0) cat(paste(TotTrees, " Tree records checked and all have a species ID.  \n")) else {
    cat("Tree records with no species name:  \n"); NiceTable(Trees_No_Name)}

```


---

### Tree Tag

```{r Tree_Tag, echo=FALSE, hold=FALSE, results="asis"}
 if(nrow(Trees_Bad_Tag)==0) cat(paste(TotTrees, " Tree records checked and all have a valid tag.  \n")) else {
    cat("Tree records with an invalid tag:  \n"); NiceTable(Trees_Bad_Tag)}

```

---

### Tree Crown

```{r Tree_Crown, echo=FALSE, hold=FALSE, results="asis"}
 
 if(nrow(Trees_Live_Bad_Crown)==0) cat(paste(TotTrees, " Tree records checed and all living trees have a valid crown description.  \n")) else {
    cat("Living Tree records with an invalid crown descirption:  \n"); NiceTable(Trees_Live_Bad_Crown)}

 if(nrow(Trees_Unalive_Bad_Crown)==0) cat(paste(TotTrees, " Tree records checked and no non-living trees have a crown description.  \n")) else { 
    cat("Non-living tree records with a crown description:  \n"); NiceTable(Trees_Unalive_Bad_Crown)}
```

---

### Tree Diameter

```{r Tree_Diameter, echo=FALSE, hold=FALSE, results="asis"}

 if(nrow(Trees_Bad_DBH_Check)==0) cat(paste(TotTrees, " Tree records checked and none have an inappropriate DBH check.  \n")) else { 
    cat("Tree records with an inappropriate DBH check:  \n"); NiceTable(Trees_Bad_DBH_Check)}

 if(nrow(Trees_Live_Bad_DBH)==0) cat(paste(TotTrees, " Tree records checked and no live trees have an invlid DBH.  \n")) else { 
    cat("Live tree records with an invalid DBH:  \n"); NiceTable(Trees_Live_Bad_DBH)}
 
if(nrow(Trees_Dead_Bad_DBH)==0) cat(paste(TotTrees, " Tree records checked and no dead trees have an invlid DBH.  \n")) else { 
    cat("Dead tree records with an invalid DBH:  \n"); NiceTable(Trees_Dead_Bad_DBH)}

if(nrow(Trees_Other_Bad_DBH)==0) cat(paste(TotTrees, " Tree records checked and no trees have a DBH when they should not.  \n")) else { 
    cat("Tree records with a DBH that should not have one:  \n"); NiceTable(Trees_Other_Bad_DBH)}

```

---


### Stem Diameter

```{r Stem_Diameter, echo=FALSE, hold=FALSE, results="asis"}

 if(nrow(Stems_Live_Bad_DBH)==0) cat(paste(TotStems, " Stems records checked and no live stems have an invlid DBH.  \n")) else { 
    cat("Live stem records with an invalid DBH:  \n"); NiceTable(Stems_Live_Bad_DBH)}

 if(nrow(Stems_Dead_Bad_DBH)==0) cat(paste(TotStems, " Stems records checked and no dead stems have an invlid DBH.  \n")) else { 
    cat("Dead stem records with an invalid DBH:  \n"); NiceTable(Stems_Dead_Bad_DBH)}
 
 if(nrow(Stems_Other_Bad_DBH)==0) cat(paste(TotTrees, " Stem records checked and no stems have a DBH when they should not.  \n")) else { 
    cat("Stem records with a DBH that should not have one:  \n"); NiceTable(Stems_Other_Bad_DBH)}

```

---



### Tree Vigor

```{r Tree_vigor, echo=FALSE, hold=FALSE, results="asis"}
 
 if(nrow(Trees_Live_Bad_Vigor)==0) cat(paste(TotTrees, " Tree records checked and all live trees have a valid vigor.  \n")) else {
    cat("Living tree records with an invalid vigor:  \n"); NiceTable(Trees_Live_Bad_Vigor)}

 if(nrow(Trees_Unalive_Bad_Vigor)==0) cat(paste(TotTrees, " Tree records checked and no non-living trees have a vigor.  \n")) else {
    cat("Non-living tree records with a vigor:  \n"); NiceTable(Trees_Unalive_Bad_Vigor)}

```


